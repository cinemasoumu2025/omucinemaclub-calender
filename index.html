<!DOCTYPE html>
<html>
<head>
  <base target="_top">
<style>
/* =============================
   ã‚«ãƒ©ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³
============================= */
:root {
  --frame-color: #6a5142;
  --bg-washi: #fbfaf7;
  --ink-black: #0b0b0b;
  --text-white: #ffffff;
  --led-green: #3cff6a;
}

#loadingScreen {
  position: fixed;
  inset: 0;
  background: #fff;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1.2rem;
  z-index: 20000;
}



/* =============================
   å…¨ä½“
============================= */
/* =============================
   å…¨ä½“ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¿®æ­£
============================= */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  overflow-y: auto;   /* â† å…¨ä½“ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã« */
  -webkit-overflow-scrolling: touch; /* ã‚¹ãƒãƒ›æ»‘ã‚‰ã‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
}

body {
  background: var(--bg-washi);
  color: #222;
  font-family: "Hiragino Mincho ProN","Yu Mincho",serif;
}

.cookie {
  background: #fff;
  border: 1.5px solid var(--frame-color);
  border-radius: 6px;
  padding: 10px;
  overflow: visible;  /* â† auto ã‚„ hidden ã¯é¿ã‘ã‚‹ */
}

/* =============================
   é›»å…‰æ²ç¤ºæ¿ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
============================= */
#board {
  margin-top: 16px;
  font-family: 'Courier New', monospace;
  color: #000;
}

/* ===== PCåŸºæœ¬ ===== */
.board-head,
.board-row {
  display: grid;
  grid-template-columns:
    56px       /* ãƒ©ãƒ™ãƒ« */
    96px       /* é–‹å§‹æ™‚åˆ» */
    72px       /* æ‰€è¦æ™‚é–“ */
    minmax(260px, 1fr); /* ä½œå“å */
  gap: 6px;
  align-items: center;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.board-head {
  font-weight: bold;
  border-bottom: 1px solid #ccc;
  padding-bottom: 6px;
  background: #fff;
}

/* ãƒ©ãƒ™ãƒ« */
.label {
  text-align: center;
  font-weight: bold;
  background: #fff;
}

.vertical-line {
  width: 1px;
  background: #ccc;
  height: 100%;
  margin: 0 4px;
}


/* =============================
   ãƒ•ãƒªãƒƒãƒ—ã‚»ãƒ«ï¼ˆå…±é€šãƒ»1ã‚»ãƒ«1è¡Œï¼‰
============================= */
.outer {
  position: relative;
  height: 2.2em;
  background: #000;
  overflow: hidden;
  perspective: 800px;
  border-radius: 4px;
}

/* ãƒ•ãƒªãƒƒãƒ—æœ¬ä½“ */
.flap {
  position: absolute;
  inset: 0;
  background: linear-gradient(#222, #111, #222);
  color: #fff;
  font-weight: bold;
  text-align: center;
  white-space: nowrap;
  backface-visibility: hidden;
}

/* ãƒ¡ã‚¤ãƒ³é¢ */
.flap.main {
  display: flex;
  align-items: center;  /* ç¸¦ä¸­å¤® */
  justify-content: center; /* æ¨ªä¸­å¤® */
  height: 100%;
  font-weight: bold;
}


/* ä¸Šä¸‹ãƒ•ãƒ©ãƒƒãƒ—ï¼ˆå‚è€ƒã‚³ãƒ¼ãƒ‰å®Œå…¨æº–æ‹ ï¼‰ */
/* ä¸Šä¸‹ãƒ•ãƒ©ãƒƒãƒ— */
.flap.top,
.flap.bottom {
  clip-path: polygon(0 0,100% 0,100% 50%,0 50%);
  /* display: none; â† ãƒ•ãƒªãƒƒãƒ—ä¸­ã¯ JS å´ã§åˆ¶å¾¡ã™ã‚‹ã®ã§åˆæœŸéè¡¨ç¤ºã¯ ok */
  
  display: flex;                /* è¿½åŠ  */
  align-items: center;          /* ç¸¦ä¸­å¤® */
  justify-content: center;      /* æ¨ªä¸­å¤® */
  height: 50%;                  /* ä¸Šä¸‹ãã‚Œãã‚ŒåŠåˆ† */
  font-family: inherit;          /* main ã¨åŒã˜ãƒ•ã‚©ãƒ³ãƒˆ */
  font-size: inherit;            /* main ã¨åŒã˜ã‚µã‚¤ã‚º */
  line-height: inherit;          /* main ã¨åŒã˜é«˜ã• */
  font-weight: inherit;          /* main ã¨åŒã˜å¤ªã• */
}

.flap.top {
  clip-path: polygon(0 0,100% 0,100% 50%,0 50%);
  display: none;
}

.flap.bottom {
  clip-path: polygon(0 50%,100% 50%,100% 100%,0 100%);
  display: none;
}

/* =============================
   æ•°å­—ç”¨ãƒ•ãƒªãƒƒãƒ—
============================= */
.flap.main,
.flap.top,
.flap.bottom {
  font-family: "Microsoft YaHei", sans-serif; /* æ•°å­—ç”¨ãƒ•ã‚©ãƒ³ãƒˆ */
  line-height: 2.2em;  /* é«˜ã•ã«åˆã‚ã›ã¦ç¸¦ä¸­å¤®æƒãˆ */
  font-weight: bold;
  text-align: center;
  font-size: 1rem;     /* main ã¨åŒã˜ã‚µã‚¤ã‚º */
}

/* å¢ƒç•Œç·š */
.gap {
  position: absolute;
  top: 50%;
  width: 100%;
  height: 1px;
  background: #000;
  opacity: .6;
  z-index: 20;
}

/* =============================
   æ™‚åˆ»ãƒ»æ‰€è¦æ™‚é–“
============================= */
.time-wrapper {
  display: flex;
  align-items: center;
  height: 2.2em;          /* â† outerã¨å®Œå…¨ä¸€è‡´ã•ã›ã‚‹ */
  line-height: 2.2em;     /* â† baselineã‚ºãƒ¬é˜²æ­¢ */
  gap: 4px;
}

/* æ™‚åˆ» */
.time-wrapper .outer {
  width: 2.6ch;
}

/* æ‰€è¦æ™‚é–“ï¼ˆ3æ¡æƒ³å®šï¼‰ */
.outer.duration {
  width: 3.6ch;
  height: 2.6em;          /* æ˜ç¤º */
  margin-top: 0;
  margin-bottom: 0;
  align-self: center;   /* â† flexå†…ã§æ˜ç¤º */
}

.colon,
.unit {
  font-weight: bold;
  color: #000;
}

.unit {
  display: inline-flex;   /* â† inline ã‚’ã‚„ã‚ã‚‹ */
  align-items: center;    /* â† ç¸¦ä¸­å¤®å›ºå®š */
  height: 2.2em;          /* â† outerã¨åŒã˜ */
  line-height: 2.2em;
}


/* =============================
   ä½œå“åï¼ˆå®Œå…¨1è¡Œåˆ¶å¾¡ï¼‰
============================= */
.outer.title {
  height: 2.2em;
  background: #000;
  position: relative;
  overflow: hidden;
}

/* ãƒ•ãƒªãƒƒãƒ—ç”¨ï¼ˆçŸ­æ–‡ï¼‰ */
.flap.title-cell {
  line-height: 2.2em;
  font-family: "BIZ UDPã‚´ã‚·ãƒƒã‚¯", sans-serif;
  font-weight: bold;
  text-align: center;
  font-size: 1rem;     /* main ã¨åŒã˜ã‚µã‚¤ã‚º */
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ï¼ˆé•·æ–‡ï¼‰ */
.title-scroll {
  position: absolute;
  inset: 0;
  display: none;
  align-items: center;
  overflow: hidden;
  color: #fff;
  font-family: "BIZ UDPã‚´ã‚·ãƒƒã‚¯", sans-serif;
  font-size: 0.95rem;
}

.title-scroll span {
  white-space: nowrap;
  animation: scrollText 12s linear infinite;
}

/* åˆ‡æ›¿ */
.outer.title.show-scroll .flap-container {
  display: none;
}
.outer.title.show-scroll .title-scroll {
  display: flex;
}

/* =============================
   ãƒ•ãƒªãƒƒãƒ—ä¸­ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
============================= */
.outer.black .flap {
  background: #000;
  color: transparent;
}



/* =============================
   å‚™è€ƒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆå®Œå…¨ç‰ˆï¼‰
============================= */
/* å‚™è€ƒè¡Œå…¨ä½“ã‚’1è¡Œåˆ†ã®é«˜ã•ã« */
.board-notes {
  display: grid;
  grid-template-columns: 56px 1fr;
  align-items: center;
  margin-top: 6px;
}

.board-notes .scroll {
  background: #000;               /* é»’èƒŒæ™¯ */
  color: #00ff66;                 /* LEDã‚°ãƒªãƒ¼ãƒ³ */
  padding: 0.3em 0.6em;
  border-radius: 4px;
  font-family: "BIZ UDPã‚´ã‚·ãƒƒã‚¯", sans-serif;
  height: 2.2em;                  /* ãƒ•ãƒªãƒƒãƒ—ã‚»ãƒ«ã¨åŒã˜ */
  line-height: 2.2em;             /* ç¸¦ä¸­å¤®æƒãˆ */
  box-sizing: border-box;
  
  position: relative;              /* åŸºæº– */
  overflow: hidden;
  display: flex;
  align-items: center;
}

/* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ span */
.board-notes .scroll span {
  position: absolute;
  left: 0;
  transform: translateX(var(--start-x));
  display: inline-block;
  font-family: "BIZ UDPã‚´ã‚·ãƒƒã‚¯", sans-serif;
  white-space: nowrap;
  will-change: transform;
  animation-name: scrollText;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  animation-duration: var(--scroll-duration, 15s);
}

/* èµ¤ç‚¹æ»…ãƒ¢ãƒ¼ãƒ‰ */
.board-notes .scroll.red span {
  color: red;
  font-weight: bold;
  animation: blinkRed 1s step-start infinite;
}

/* =============================
   ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
============================= */
@keyframes scrollText {
  from { transform: translateX(var(--start-x)); }
  to   { transform: translateX(var(--end-x)); }
}

@keyframes blinkRed {
  50% { opacity: 0; }
}

/*==============================
    TTbutton
==============================*/
.tt-btn {
  border-radius: 999px;
  padding: 6px 14px;
  border: none;
  font-weight: bold;
  cursor: pointer;
}

.tt-btn.enabled {
  background: #000;
  color: #fff;
}

.tt-btn.disabled {
  background: #999;
  color: #fff;
  cursor: default;
}
#timetableHeader {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  margin-bottom: 8px;
}

#ttDate {
  text-align: center;
  font-weight: bold;
  font-size: 1.1rem;
}


/* =============================
   ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ç½«ç·š
============================= */
#timetable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
}

#timetable th,
#timetable td {
  border: 1px solid #999;
  padding: 6px 8px;
  font-family: "BIZ UDPã‚´ã‚·ãƒƒã‚¯", sans-serif;
  font-size: 0.95rem;
}

#timetable thead th {
  background: #f2f2f2;
  font-weight: bold;
}

#timetable tbody tr:nth-child(even) {
  background: #fafafa;
}

/* ä½œå“åã¯ã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹ã¨åˆ†ã‹ã‚‹ã‚ˆã†ã« */
.tt-title {
  cursor: pointer;
  text-decoration: underline;
}

/* =============================
   ãƒ¢ãƒ¼ãƒ€ãƒ«å…¨ä½“
============================= */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.65);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

/* éè¡¨ç¤º */
.hidden {
  display: none !important;
}
.modal.hidden {
  display: none;
}

.modal-content{
  background: #ffffff;
  border-radius: 28px;
  padding: 20px;
  width: 90%;
  max-width: 420px;

  max-height: 92vh;
  display: flex;
  flex-direction: column;

  box-shadow: 0 6px 15px rgba(0,0,0,.25);
}

.modal-body{
  flex: 1;                 /* â† ã“ã“é‡è¦ */
  overflow-y: auto;
  overscroll-behavior: contain;
  margin: 10px 0 12px;
  -webkit-overflow-scrolling: touch;
}



/* ===== æˆ»ã‚‹ãƒœã‚¿ãƒ³ï¼ˆä¸‹å›ºå®šï¼‰ ===== */
.modal-back{
  width: 100%;
  padding: 12px;
  border: none;
  background: #1b1b1b;
  color: #fff;
  font-weight: bold;
  font-size: 16px;
  border-radius: 20px;
  cursor: pointer;

  flex-shrink: 0;

  box-shadow:
    0 6px 10px rgba(0,0,0,.15),
    inset 0 3px 5px rgba(255,255,255,.35);
  transition: transform .1s ease, box-shadow .2s ease;
}

.modal-back:hover{
  transform: translateY(-2px);
  box-shadow:
    0 8px 14px rgba(0,0,0,.2),
    inset 0 3px 5px rgba(255,255,255,.45);
}

.modal-back:active{
  transform: translateY(0);
}

#modalClose {
  position: absolute;
  top: 8px;
  right: 10px;
  font-size: 20px;
  background: none;
  border: none;
  cursor: pointer;
}

.image-zoom-wrapper{
  position: relative;
}

.zoom-close{
  position: absolute;
  top: 8px;
  right: 8px;
  z-index: 10;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,0.65);
  color: #fff;
  font-size: 28px;
  line-height: 1;
  cursor: pointer;
}

/* æ‹¡å¤§ã—ã¦ã„ãªã„æ™‚ã¯éè¡¨ç¤º */
.zoom-close.hidden{
  display: none;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ«ç”»åƒ é€šå¸¸ */
#modalImage {
  max-width: 100%;
  height: auto;
  margin-top: 10px;
  border-radius: 6px;
  transition: transform 0.25s ease;
  transform-origin: center center;
  cursor: zoom-in;
}

/* æ‹¡å¤§çŠ¶æ…‹ */
#modalImage.zoomed {
  transform: scale(2) translate(0, 0);
  touch-action: none;
  cursor: grab;
}
#modalImage.zoomed:active{
  cursor: grabbing;
}

/*============================
ãƒªãƒ³ã‚¯ã‚¨ãƒªã‚¢
============================*/
/* ä¸‹éƒ¨ãƒªãƒ³ã‚¯ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç›´ä¸‹è¡¨ç¤ºï¼‰ */
.link-area{
  display: flex;
  flex-wrap: wrap;            /* æŠ˜ã‚Šè¿”ã—è¨±å¯ */
  grid-template-columns: repeat(3, 1fr); /* â† 3åˆ—å›ºå®š */
  margin: 12px 15px 0;
  padding: 10px 0;
  gap: 10px;
  justify-content:center;
  overflow: visible;   /* è¦ªã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜»å®³ã—ãªã„ */
}.link-area a {
  flex: 1 1 calc(33.333% - 10px); /* 3åˆ—åŒ– */
  text-align: center;
}

.link-area button{
  flex: 1 1 120px;
  border:none;
  border-radius: 18px;
  padding: 10px 14px;
  background: #1b1b1b;
  color:#fff;
  font-weight: 800;
  cursor:pointer;
  box-shadow: 0 6px 12px rgba(0,0,0,0.12);
}
.action-button {
  display: inline-block;
  padding: 10px 16px;
  border-radius: 18px;
  background-color: #1b1b1b;
  color: #fff;
  font-weight: bold;
  text-decoration: none;
  text-align: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  transition: transform 0.1s ease;
}

.action-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0,0,0,0.2);
}


.badge {
  display: inline-block;
  padding: 4px 8px;
  font-size: 12px;
  font-weight: bold;
  border-radius: 4px;
  margin-bottom: 8px;
}

.badge-new {
  background: #e60033;
  color: #fff;
}

.badge-archive {
  background: #666;
  color: #fff;
}

.duration {
  font-size: 14px;
  color: #555;
  margin-bottom: 8px;
}

#modalPdf {
  width: 100%;
  height: 60vh;
  border: none;
}







/* =============================
   ğŸ“± ã‚¹ãƒãƒ›å¯¾å¿œ
============================= */
@media (max-width: 640px) {

    .board-head {
    grid-template-columns:
      48px  /* ãƒ©ãƒ™ãƒ« */
      72px  /* é–‹å§‹æ™‚åˆ» */
      60px  /* æ‰€è¦æ™‚é–“ */
      1fr;  /* ä½œå“å */
    gap: 4px;
  }

  /* PCã¨åŒã˜1è¡Œæ§‹æˆã‚’ç¶­æŒ */
  .board-row {
    grid-template-columns:
      48px        /* ãƒ©ãƒ™ãƒ« */
      72px        /* é–‹å§‹æ™‚åˆ» */
      60px        /* æ‰€è¦æ™‚é–“ */
      1fr;        /* ä½œå“å */
    gap: 4px;
    height: 2.2em;          /* â† ã“ã‚ŒãŒæ±ºå®šæ‰“ */
    align-items: stretch;
  }

  /* ãƒ•ã‚©ãƒ³ãƒˆå¾®èª¿æ•´ */
  .outer {
    height: 2em;
  }

  .flap {
    font-size: 0.9rem;
  }

  .outer.title {
    font-size: 0.9rem;
  }
    #timetableWrapper {
    overflow-x: auto;
  }
  #timetable th,
  #timetable td {
    font-size: 0.85rem;
    padding: 4px 6px;
    white-space: normal;  /* â† ä½œå“åã ã‘æŠ˜ã‚Šè¿”ã—å¯èƒ½ã« */
  }

  /* ä½œå“åã®ã¿2è¡Œã¾ã§è¨±å¯ */
  #timetable td:nth-child(4) { 
    display: -webkit-box;
    -webkit-line-clamp: 2;  /* æœ€å¤§2è¡Œ */
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ãã®ä»–åˆ—ã¯1è¡Œå›ºå®š */
  #timetable td:not(:nth-child(4)) {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ãƒ†ãƒ¼ãƒ–ãƒ«ä¸‹ã«å›ºå®šå‚™è€ƒ */
  #ttNotes {
    margin-top: 8px;
    padding: 6px 8px;
    font-size: 0.85rem;
    background: #fafafa;
    border-top: 1px solid #ccc;
  }

  /* æ³¨æ„æ–‡ã¯ãã®ä¸‹1è¡Œ */
  #ttNotes p:last-child {
    margin-top: 4px;
  }

  /* å‚™è€ƒã¯ç¸¦ç©ã¿ã—ãªã„ */
  .board-notes {
    grid-template-columns: 48px 1fr;
  }

  .notes-scroll {
    font-size: 0.9rem;
  }
  .board-notes .scroll {
    height: 2em;
    line-height: 2em;
    font-size: 0.9rem;
    padding: 0.2em 0.4em;
  }

  .modal{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.35);

  display: none;
  justify-content: center;
  align-items: flex-end;   /* â† center â†’ flex-end */

  padding-bottom: 16px;    /* â† ä¸‹ä½™ç™½ */

  z-index: 9999;
  }

  .modal-content {
    width: 94vw;
    max-height: 90vh;
    padding: 14px;
  }

  #modalTitle {
    font-size: 1.1rem;
  }

  #modalDesc {
    font-size: 0.95rem;
  }

}


</style>
</head>
<body>
  <script id="gas-env" type="application/json">
{
  "pageType": "<?= pageType ?>",
  "siteNo": <?= siteNo ?>
}
</script>


  <div id="loadingScreen">
  èª­ã¿è¾¼ã¿ä¸­<span id="loadingDots"></span>
</div>


<!-- ã‚¿ã‚¤ãƒˆãƒ« -->
<div id="titleCookie" class="cookie">
  <div class="title" id="eventTitle"></div>
  <div id="nowDateTime"></div>
  <div class="desc" id="eventDesc"></div>
</div>

<!-- é›»å…‰æ²ç¤ºæ¿ -->
<div id="board" class="cookie">

  <!-- ãƒ˜ãƒƒãƒ€ -->
  <div class="board-head">
    <div></div>
    <div>é–‹å§‹æ™‚åˆ»</div>
    <div>æ‰€è¦æ™‚é–“</div>
    <div>ä½œå“å</div>
  </div>

  <!-- ================= æ¬¡ ================= -->
  <div class="board-row">
    <div class="label">æ¬¡</div>

    <!-- é–‹å§‹æ™‚åˆ» -->
    <div class="time-wrapper">
      <div class="outer" id="nextStartHH">
        <div class="flap-container">
          <div class="flap main"></div>
          <div class="flap top"></div>
          <div class="flap bottom"></div>
          <div class="gap"></div>
        </div>
      </div>
      <span class="colon">:</span>
      <div class="outer" id="nextStartMM">
        <div class="flap-container">
          <div class="flap main"></div>
          <div class="flap top"></div>
          <div class="flap bottom"></div>
          <div class="gap"></div>
        </div>
      </div>
    </div>

    <!-- æ‰€è¦æ™‚é–“ -->
    <div class="time-wrapper">
      <div class="outer duration" id="nextDurationNum">
        <div class="flap-container">
          <div class="flap main"></div>
          <div class="flap top"></div>
          <div class="flap bottom"></div>
          <div class="gap"></div>
        </div>
      </div>
      <span class="unit">åˆ†</span>
    </div>

    <!-- ä½œå“å -->
    <div class="outer title" id="nextTitle">
      <!-- ãƒ•ãƒªãƒƒãƒ—ç”¨ï¼ˆçŸ­æ–‡ï¼‰ -->
      <div class="flap-container">
        <div class="flap main title-cell"></div>
        <div class="flap top"></div>
        <div class="flap bottom"></div>
        <div class="gap"></div>
      </div>

      <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”¨ï¼ˆé•·æ–‡ï¼‰ -->
      <div class="title-scroll">
        <span></span>
      </div>
    </div>
  </div>

  <!-- ================= æ¬¡ã€…å› ================= -->
  <div class="board-row">
    <div class="label">æ¬¡ã€…å›</div>

    <!-- é–‹å§‹æ™‚åˆ» -->
    <div class="time-wrapper">
      <div class="outer" id="next2StartHH">
        <div class="flap-container">
          <div class="flap main"></div>
          <div class="flap top"></div>
          <div class="flap bottom"></div>
          <div class="gap"></div>
        </div>
      </div>
      <span class="colon">:</span>
      <div class="outer" id="next2StartMM">
        <div class="flap-container">
          <div class="flap main"></div>
          <div class="flap top"></div>
          <div class="flap bottom"></div>
          <div class="gap"></div>
        </div>
      </div>
    </div>

    <!-- æ‰€è¦æ™‚é–“ -->
    <div class="time-wrapper">
      <div class="outer duration" id="next2DurationNum">
        <div class="flap-container">
          <div class="flap main"></div>
          <div class="flap top"></div>
          <div class="flap bottom"></div>
          <div class="gap"></div>
        </div>
      </div>
      <span class="unit">åˆ†</span>
    </div>

    <!-- ä½œå“å -->
    <div class="outer title" id="next2Title">
      <div class="flap-container">
        <div class="flap main title-cell"></div>
        <div class="flap top"></div>
        <div class="flap bottom"></div>
        <div class="gap"></div>
      </div>
      <div class="title-scroll">
        <span></span>
      </div>
    </div>
  </div>
  <!-- å‚™è€ƒï¼ˆç‹¬ç«‹æ ï¼‰ -->
  <div class="board-notes">
  <div class="notes-label">å‚™è€ƒ</div>
  <div class="scroll notes-scroll" id="nextNotes">
    <span>---</span>
  </div>
</div>


</div>

<!-- ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã€ãƒœã‚¿ãƒ³ã¯å…ƒã®ã¾ã¾ -->
<div id="timetableCookie" class="cookie">
  <div id="timetableWrapper" class="cookie">
    <div id="timetableHeader">
      <button id="prevDay" class="tt-btn">â—€å‰ã®æ—¥ã¸</button>
      <span id="ttDate"></span>
      <button id="nextDay" class="tt-btn">æ¬¡ã®æ—¥ã¸â–¶</button>
    </div>
    <table id="timetable">
      <thead>
        <tr>
          <th>ç•ªå·</th>
          <th>é–‹å§‹æ™‚åˆ»</th>
          <th>æ‰€è¦æ™‚é–“</th>
          <th>ä½œå“å</th>
          <th>æ³¨æ„</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div>æ³¨æ„è¨˜å·ã«é–¢ã™ã‚‹èª¬æ˜</div>
    <div id="ttNotes">      
      <p></p>
    </div>
    <div>é–‹å§‹æ™‚åˆ»ã¾ã§ã«ä¸Šæ˜ ä¼šå ´å†…ã«ã”å…¥å ´ãã ã•ã„</div>
  </div>
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ã¤ã„ã¦-->

<div id="modal" class="modal hidden">
  <div class="modal-content">

    <button id="modalClose">Ã—</button>
    <div class="modal-body">
    <!-- ä½œå“å -->
    <h2 id="modalTitle"></h2>

    <!-- ãµã‚ŠãŒãª -->
    <div id="modalRuby" style="font-size:0.9rem;color:#666;"></div>

    <!-- ã‚«ãƒ†ã‚´ãƒªï¼ˆæ–°ä½œ/éå»ä½œï¼‰ -->
    <div id="modalBadge" class="badge"></div>

    <!-- æ‰€è¦æ™‚é–“ -->
    <div id="modalDuration" class="duration"></div>


      <!-- ç´¹ä»‹æ–‡ -->
      <p id="modalDesc"></p>

      <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨å‚™è€ƒï¼ˆIåˆ—ï¼‰ -->
      <div id="modalNote"
           style="margin-top:10px;font-size:0.95rem;"></div>

      <!-- æ³¨æ„è¨˜å· -->
      <div id="modalCaution"
           style="margin-top:10px;font-size:0.9rem;color:#900;"></div>

      <!-- ç”»åƒ -->
      <!-- ç”»åƒæ“ä½œãƒœã‚¿ãƒ³ -->
      <div class="image-zoom-wrapper">
      <img id="modalImage" />
      <button id="imageZoomClose" class="zoom-close hidden">Ã—</button>
      </div>
      <!-- SVGç›´æ¥åŸ‹ã‚è¾¼ã¿ç”¨ -->
      <div id="modalImageSvg" style="margin-top:10px;"></div>
      <!-- PDFè¡¨ç¤ºç”¨ -->
      <iframe id="modalPdf" class="hidden" loading="lazy"></iframe>
      
    </div>

    <button id="modalBack" class="modal-back">æˆ»ã‚‹</button>

  </div>
</div>


<div id="buttonCookie" class="cookie">
<!-- ãƒªãƒ³ã‚¯ã‚¨ãƒªã‚¢ -->
<div id="linkArea" class="link-area" ></div>
</div>

  <script>
    // ===== ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ =====
    let worksReady = false;
    let workDetailCache = {};





    // ===== ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ =====

    let dotCount = 0;
  const dotTimer = setInterval(() => {
  const dots = '.'.repeat(dotCount % 4);
  document.getElementById('loadingDots').textContent = dots;
  dotCount++;
  }, 500);

  function stopLoadingScreen() {
  clearInterval(dotTimer);
  const el = document.getElementById('loadingScreen');
  if (el) el.remove();
  }

  let PAGE_TYPE;
  let SITE_NO;

  const API_URL = "https://script.google.com/macros/s/AKfycbxxpzlMuaf743UFqJFN-SSCiOLkTRERHZpLBqQ0bkR0THFUMlMp14NX_Z5S3soZThhf-g/exec";
  function callGAS(action, params = {}) {

  // ===== GASç’°å¢ƒ =====
  if (window.google?.script?.run) {
    return new Promise(resolve => {
      google.script.run
        .withSuccessHandler(resolve)[action](...Object.values(params));
    });
  }

  // ===== GitHubç’°å¢ƒ =====
  const url = new URL(API_URL);
  url.searchParams.set("api","true");
  url.searchParams.set("action", action);

  Object.entries(params).forEach(([k,v])=>{
    url.searchParams.set(k,v);
  });

  return fetch(url).then(r => r.json());
}

// ===== GAS / GitHub å…±é€šåˆ¤å®š =====
const gasEnvEl = document.getElementById('gas-env');

if (gasEnvEl) {
  try {
    const env = JSON.parse(gasEnvEl.textContent);
    PAGE_TYPE = env.pageType;
    SITE_NO   = Number(env.siteNo);
  } catch (e) {
    console.warn('gas-env parse failed');
  }
}

// GitHub Pages fallback
if (!PAGE_TYPE || !SITE_NO) {
  const params = new URLSearchParams(window.location.search);
  PAGE_TYPE = params.get('page') || 'index';
  SITE_NO   = Number(params.get('n') || 1);
}




// =============================
// é›»å…‰æ²ç¤ºæ¿ å®Œå…¨åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ã€å®Œæˆç‰ˆã€‘
// =============================

let displayData = { next: null, next2: null };
let worksList = [];
let flipping = false;
let lastNotesText = '';

const cells = {
  next: {
    hh: document.getElementById('nextStartHH'),
    mm: document.getElementById('nextStartMM'),
    dur: document.getElementById('nextDurationNum'),
    title: document.getElementById('nextTitle')
  },
  next2: {
    hh: document.getElementById('next2StartHH'),
    mm: document.getElementById('next2StartMM'),
    dur: document.getElementById('next2DurationNum'),
    title: document.getElementById('next2Title')
  }
};

const scrollNotes = document.getElementById('nextNotes');

// =============================
// å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// =============================
const sleep = ms => new Promise(r => setTimeout(r, ms));

function setCellText(el, text) {
  const main = el.querySelector('.flap.main');
  const top = el.querySelector('.flap.top');
  const bottom = el.querySelector('.flap.bottom');
  main.textContent = top.textContent = bottom.textContent = text;
}

function safe2(v) {
  return isNaN(v) ? '--' : String(v).padStart(2, '0');
}

// =============================
// ãƒ•ãƒªãƒƒãƒ—ï¼ˆå‚è€ƒã‚³ãƒ¼ãƒ‰å®Œå…¨æº–æ‹ ï¼‰
// =============================
async function flipFlap(el, nextText, duration = 100) {
  const main = el.querySelector('.flap.main');
  const top = el.querySelector('.flap.top');
  const bottom = el.querySelector('.flap.bottom');

  top.textContent = nextText;
  top.style.display = bottom.style.display = 'block';

  main.style.zIndex = 11;
  bottom.style.zIndex = 12;
  top.style.zIndex = 10;

  let anim = main.animate([{ transform: 'rotateX(-90deg)' }], { duration });
  await anim.finished;

  main.style.transform = 'rotateX(90deg)';
  main.textContent = nextText;

  main.style.zIndex = 11;
  bottom.style.zIndex = 10;
  top.style.zIndex = 12;

  anim = main.animate([{ transform: 'rotateX(0deg)' }], {
    duration,
    fill: 'forwards'
  });
  await anim.finished;

  bottom.textContent = nextText;
  top.style.display = bottom.style.display = 'none';
}

// =============================
// æ•°å­—ãƒ•ãƒªãƒƒãƒ—
// =============================
async function flipNumber(el, from, to, step, durationMs) {
  const end = Date.now() + durationMs;
  let v = from;

  while (Date.now() < end && v <= to) {
    await flipFlap(el, safe2(v));
    v += step;
  }
  setCellText(el, safe2(to));
}
// =============================
// ä½œå“åãƒ©ãƒ³ãƒ€ãƒ å›è»¢ï¼ˆWorks ä½¿ç”¨ï¼‰
// =============================
function clearNotes(){
  lastNotesText = '';
  scrollNotes.innerHTML = '<span>---</span>';
  scrollNotes.dataset.currentText = '';
}

async function spinRandomTitlesSteps(el, totalSteps) {
  if (!worksList || !worksList.length) return;

  // å›è»¢ä¸­ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç„¡åŠ¹
  el.classList.remove('show-scroll');
  el.querySelector('.title-scroll span').textContent = '';

  const flapContainer = el.querySelector('.flap-container');
  const flap = flapContainer.querySelector('.flap.main');
  const top = flapContainer.querySelector('.flap.top');
  const bottom = flapContainer.querySelector('.flap.bottom');

  for (let i = 0; i < totalSteps; i++) {
    const title = worksList[Math.floor(Math.random() * worksList.length)];

    // ä¸Šãƒ•ãƒ©ãƒƒãƒ—ã«æ¬¡ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚»ãƒƒãƒˆã—ã¦è¡¨ç¤º
    top.textContent = title;
    top.style.display = bottom.style.display = 'block';

    flap.style.zIndex = 11;
    bottom.style.zIndex = 12;
    top.style.zIndex = 10;

    // å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆä¸ŠåŠåˆ†æŠ˜ã‚ŠãŸãŸã¿ï¼‰
    let anim = flap.animate([{ transform: 'rotateX(-90deg)' }], { duration: FLIP_MS });
    await anim.finished;

    flap.style.transform = 'rotateX(90deg)';
    flap.textContent = title;

    flap.style.zIndex = 11;
    bottom.style.zIndex = 10;
    top.style.zIndex = 12;

    // å›è»¢æˆ»ã—
    anim = flap.animate([{ transform: 'rotateX(0deg)' }], { duration: FLIP_MS, fill: 'forwards' });
    await anim.finished;

    bottom.textContent = title;
    top.style.display = bottom.style.display = 'none';
  }
}




// =============================
// ã‚¿ã‚¤ãƒˆãƒ«åˆ¶å¾¡
// =============================
function setTitle(el, text) {
  const isLong = text.length > 14;

  const flap = el.querySelector('.flap.main.title-cell');
  const scroll = el.querySelector('.title-scroll span');

  el.classList.toggle('show-scroll', isLong);

  if (isLong) {
    flap.textContent = '';
    scroll.textContent = text;

    const boxWidth = el.offsetWidth;
    const textWidth = scroll.offsetWidth;

    if (textWidth <= boxWidth) return; // é•·ã•ä¸è¶³ãªã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸è¦

    const speed = 60; // px/sec
    const distance = boxWidth + textWidth;
    const duration = distance / speed;

    scroll.style.setProperty('--start-x', `${boxWidth}px`);
    scroll.style.setProperty('--end-x', `-${textWidth}px`);
    scroll.style.setProperty('--scroll-duration', `${duration}s`);
    scroll.style.animation = `scrollText var(--scroll-duration) linear infinite`;
  } else {
    flap.textContent = text;
    scroll.textContent = '';
  }
}

function activateTitleScroll(el) {
  const span = el.querySelector('.title-scroll span');
  const text = span.textContent;
  if (!text) return;

  const textWidth = span.offsetWidth;
  const boxWidth = el.offsetWidth;
  if (textWidth <= boxWidth) return;

  const speed = 120; // px/s
  const distance = boxWidth + textWidth;
  const duration = distance / speed;

  span.style.setProperty('--start-x', `${boxWidth}px`);
  span.style.setProperty('--end-x', `-${textWidth}px`);
  span.style.setProperty('--scroll-duration', `${duration}s`);
  span.style.animation = `scrollText var(--scroll-duration) linear infinite`;
}



function getCurrentNumber(el) {
  const text = el.querySelector('.flap.main')?.textContent;
  const n = parseInt(text, 10);
  return isNaN(n) ? 0 : n;
}

// =============================
// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
// =============================

function updateNotes(data) {
  const text = [
    data?.notes,
    typeof shopInfo !== 'undefined' ? shopInfo : '',
    typeof recruitInfo !== 'undefined' ? recruitInfo : ''
  ].filter(Boolean).join('ã€€');

  if (text === lastNotesText) return;
  lastNotesText = text;
}

// =============================
// ãƒ–ãƒ©ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
// =============================
function setBlack(target, on) {
  Object.values(cells[target]).forEach(el => {
    el.classList.toggle('black', on);
  });
}

function calcStepsToLimit(current, limit, step) {
  if (current > limit) return 0;
  return Math.floor((limit - current) / step) + 1;
}

const FLIP_MS = 100;
function getCurrentValue(el) {
  const text = el.querySelector('.flap.main')?.textContent;
  const n = parseInt(text, 10);
  return isNaN(n) ? 0 : n;
}


function calcPreBlackTotalSteps(cell) {
  const hhNow  = getCurrentValue(cell.hh);
  const mmNow  = getCurrentValue(cell.mm);
  const durNow = getCurrentValue(cell.dur);

  const hhSteps  = Math.max(0, Math.floor((26 - hhNow) / 1) + 1);
  const mmSteps  = Math.max(0, Math.floor((59 - mmNow) / 1) + 1);
  const durSteps = Math.max(0, Math.floor((180 - durNow) / 5) + 1);

  // ä¸€ç•ªé•·ã„ã‚»ãƒ«ã«å…¨ä½“ã‚’åˆã‚ã›ã‚‹
  return Math.max(hhSteps, mmSteps, durSteps);
}

async function flipBlack(el, durationMs) {
  el.classList.add('black');

  const end = Date.now() + durationMs;
  let v = 0;

  while (Date.now() < end) {
    await flipFlap(el, safe2(v % 100));
    v++;
  }
}
async function flipUntilLimitWithBlack(el, start, limit, step, totalSteps) {
  let v = start;
  let steps = 0;

  // â‘  ä¸Šé™ã¾ã§é€šå¸¸å›è»¢
  while (v <= limit && steps < totalSteps) {
    await flipFlap(el, safe2(v), FLIP_MS);
    v += step;
    steps++;
  }

  // â‘¡ æ®‹ã‚Šã¯é»’å›è»¢
  while (steps < totalSteps) {
    el.classList.add('black');
    await flipFlap(el, safe2(Math.floor(Math.random() * 99)), FLIP_MS);
    steps++;
  }
}






// =============================
// ãƒ¡ã‚¤ãƒ³æ›´æ–°ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
// =============================
async function preBlackSequence(target) {
  const cell = cells[target];
  clearNotes();

  // â‘  å¿…è¦ã‚¹ãƒ†ãƒƒãƒ—æ•°ã‚’ç®—å‡º
  const totalSteps = calcPreBlackTotalSteps(cell);
  const A = totalSteps * FLIP_MS;

  await Promise.all([
    flipUntilLimitWithBlack(
      cell.hh,
      getCurrentValue(cell.hh),
      26,
      1,
      totalSteps
    ),
    flipUntilLimitWithBlack(
      cell.mm,
      getCurrentValue(cell.mm),
      59,
      1,
      totalSteps
    ),
    flipUntilLimitWithBlack(
      cell.dur,
      getCurrentValue(cell.dur),
      180,
      5,
      totalSteps
    ),
    spinRandomTitlesSteps(cell.title, totalSteps)
  ]);

  // å®Œå…¨ãƒ–ãƒ©ãƒƒã‚¯
  setBlack(target, true);

  setCellText(cell.hh, '00');
  setCellText(cell.mm, '00');
  setCellText(cell.dur, '00');
}


async function fetchNextData() {
  return new Promise(resolve => {
      callGAS("getNextScheduleForBoard",{siteNo:SITE_NO})
      .then(resolve);
  });
}

/*ç›®æ¨™å€¤ã¾ã§ã®ã‚¹ãƒ†ãƒƒãƒ—æ•°è¨ˆç®—*/

function calcRevealSteps(targetValue, step) {
  if (targetValue <= 0) return 1;
  return Math.floor(targetValue / step) + 1;
}


/*ã‚¹ãƒ†ãƒƒãƒ—åˆ¶å¾¡å‹*/
async function flipUntilTarget(el, target, step, totalSteps) {
  let v = 0;
  let steps = 0;

  while (steps < totalSteps) {
    if (v <= target) {
      await flipFlap(el, safe2(v), FLIP_MS);
      v += step;
    } else {
      // ç›®æ¨™åˆ°é”å¾Œã¯ä½•ã‚‚ã—ãªã„ï¼ˆè¡¨ç¤ºå›ºå®šï¼‰
      await sleep(FLIP_MS);
    }
    steps++;
  }

  setCellText(el, safe2(target));
}


async function revealSequence(target, data) {
  const cell = cells[target];
  setBlack(target, false);

  const [h, m] = data.startTime.split(':').map(Number);
  const d = data.durationMin;

  // â‘  å„ã‚»ãƒ«ã®å¿…è¦ã‚¹ãƒ†ãƒƒãƒ—
  const hhSteps  = calcRevealSteps(h, 1);
  const mmSteps  = calcRevealSteps(m, 1);
  const durSteps = calcRevealSteps(d, 5);

  // â‘¡ æœ€å¤§ã‚¹ãƒ†ãƒƒãƒ—æ•°ã«åŒæœŸ
  const totalSteps = Math.max(hhSteps, mmSteps, durSteps);
  const totalDuration = totalSteps * FLIP_MS;

  await Promise.all([
    flipUntilTarget(cell.hh, h, 1, totalSteps),
    flipUntilTarget(cell.mm, m, 1, totalSteps),
    flipUntilTarget(cell.dur, d, 5, totalSteps),
    spinRandomTitlesSteps(cell.title, totalSteps)
  ]);

  setTitle(cell.title, data.title);
  activateTitleScroll(cell.title);
  updateNotesBoard();
}



async function updateBoard() {
  if (flipping) return;
  flipping = true;

  /* ===== A. ãƒ—ãƒ¬ãƒ–ãƒ©ãƒƒã‚¯ï¼ˆ5ç§’ï¼‰ ===== */
  await Promise.all([
    preBlackSequence('next', 5000),
    preBlackSequence('next2', 5000)
  ]);

  /* ===== B. ãƒ–ãƒ©ãƒƒã‚¯ç¶­æŒï¼‹æ–°ãƒ‡ãƒ¼ã‚¿å–å¾— ===== */
  const list = await fetchNextData();
  displayData.next = list[0];
  displayData.next2 = list[1];

  /* ===== C + D. é»’è§£é™¤ â†’ æ­£è§£ ===== */
  await revealSequence('next', displayData.next, 2500);

  await sleep(1200);

  if (displayData.next2) {
    await revealSequence('next2', displayData.next2, 2000);
  }

  flipping = false;
}



// =============================
// åˆå›èµ·å‹•
// =============================
async function firstBoot() {
  const list = await new Promise(resolve => {
      callGAS("getNextScheduleForBoard",{siteNo:SITE_NO})
      .then(resolve);
  });

  displayData.next = list[0];
  displayData.next2 = list[1];
  updateNotesBoard();
  updateBoard(displayData.next);
}

// =============================
// æ™‚åˆ»ç›£è¦–ï¼ˆé–‹å§‹2åˆ†å¾Œï¼‰
// =============================
function watchTime() {
  if (!displayData.next || flipping) return;

  const [h, m] = displayData.next.startTime.split(':').map(Number);
  const start = new Date();
  start.setHours(h, m, 0, 0);

  if (Date.now() - start >= 2 * 60 * 1000) {
    firstBoot();
  }
}

// =============================
// ãƒ¢ãƒ¼ãƒ€ãƒ«é€£æºï¼ˆæ²ç¤ºæ¿ã‚¿ã‚¤ãƒˆãƒ«ï¼‰
// =============================
cells.next.title.onclick = () => {
  if (flipping) return;
  if (!displayData.next?.workId) return;

  openWorkModal(displayData.next.workId); // â˜… ã“ã‚Œã ã‘
};

cells.next2.title.onclick = () => {
  if (flipping) return;
  if (!displayData.next2?.workId) return;

  openWorkModal(displayData.next2.workId); // â˜… ã“ã‚Œã ã‘
};



// =============================
// å‚™è€ƒæ¬„
// =============================
let lastNoteText = '';
let lastNoteMode = '';

async function updateNotesBoard() {

  const res = await callGAS("getBoardNotes",{siteNo:SITE_NO});

  let text = '';
  let mode = res.mode || 'none';

  if (mode === 'none') {
    text = '---';
  } else if (mode === 'alert') {
    text = res.text || 'ã¾ã‚‚ãªãä¸Šæ˜ é–‹å§‹';
  } else if (res.text) {
    text = res.text;
  } else {
    text = '---';
  }

  const isAlert = mode === 'alert';

  if (text === lastNoteText && mode === lastNoteMode) return;

  lastNoteText = text;
  lastNoteMode = mode;

  setScrollText(scrollNotes, text, isAlert);
}


function setScrollText(el, text, isAlert = false) {

  // â˜… åŒä¸€ãƒ†ã‚­ã‚¹ãƒˆã‹ã¤ alert ã§ãªã‘ã‚Œã°ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¶­æŒ
  if (el.dataset.currentText === text && !isAlert) return;

  el.dataset.currentText = text;

  el.innerHTML = '';
  const span = document.createElement('span');
  span.textContent = text;

  if (isAlert) {
    span.style.color = 'red';
    span.style.animation = 'blinkRed 1s step-start infinite';
  } else {
    span.style.color = '#00ff66';
  }

  el.appendChild(span);

  requestAnimationFrame(() => {
    if (isAlert) return;
    if (!text || text === '---') return;

    const textWidth = span.offsetWidth;
    const boxWidth = el.offsetWidth;
    const speed = 120;
    const distance = boxWidth + textWidth;
    const duration = distance / speed;

    span.style.setProperty('--start-x', `${boxWidth}px`);
    span.style.setProperty('--end-x', `-${textWidth}px`);
    span.style.setProperty('--scroll-duration', `${duration}s`);

    span.style.animation = `scrollText var(--scroll-duration) linear infinite`;
  });
}

// å›è»¢çµ‚äº†å¾Œã«å†æ›´æ–°
updateNotesBoard();



// =============================
// åˆæœŸåŒ–
// =============================
window.addEventListener('load', () => {
  callGAS("getWorksList").then(list => worksList = list);
  firstBoot();
  setInterval(updateNotesBoard, 30000);
  updateNotesBoard(); // åˆå›å®Ÿè¡Œ
  setInterval(watchTime, 1000);
});

// ===== é›»å…‰æ²ç¤ºæ¿çµ‚äº† =====

// =============================
// ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¥å˜ä½ãƒ»å®Œå…¨åˆ¶å¾¡ï¼‰ã€ä¿®æ­£ç‰ˆã€‘
// =============================

let timetableDays = [];
let dayIndex = 0;

// åˆæœŸãƒ­ãƒ¼ãƒ‰
function initTimetable() {
  console.log('initTimetable called, PAGE_TYPE=', PAGE_TYPE);

  callGAS("getEventTimetableBySite", { siteNo: SITE_NO })
  .then(days => {
    console.log('timetable days=', days);

    if (!days || days.length === 0) {
      document.getElementById('timetableCookie').style.display = 'none';
      return;
    }

    timetableDays = days;
    dayIndex = getDefaultDayIndex();
    renderDay();
    updateDayButtons();
  });
  // ===== ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«è‡ªå‹•æ›´æ–°ï¼ˆ5åˆ†ï¼‰=====
  if (['index', 'top'].includes(PAGE_TYPE)) {
  setInterval(() => {
      callGAS("getEventTimetableBySite", { siteNo: SITE_NO })
  .then(days => {
      if (!days || !days.length) return;

      timetableDays = days;
      if (dayIndex >= timetableDays.length) {
        dayIndex = timetableDays.length - 1;
      }
      renderDay();
      updateDayButtons();
    });
  }, 5 * 60 * 1000); // 5åˆ†
  }
}


// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºæ—¥
function getDefaultDayIndex() {
  const today = new Date();

  for (let i = 0; i < timetableDays.length; i++) {
    const d = timetableDays[i];
    const date = new Date(d.year, d.month - 1, d.day);
    if (today <= date) return i;
  }
  return timetableDays.length - 1;
}

// 1æ—¥åˆ†æç”»
function renderDay() {
  const day = timetableDays[dayIndex];

  document.getElementById('ttDate').textContent =
    `${day.month}æœˆ${day.day}æ—¥`;

  const tbody = document.querySelector('#timetable tbody');
  tbody.innerHTML = '';

  // ===== è¡¨ç¤ºç”¨ã«ä¸¦ã³æ›¿ãˆ =====
  const sortedRows = [...day.rows].sort((a, b) => {
    const aEnded = a.startTime === 'ä¸Šæ˜ çµ‚äº†' || a.startTime === 'ä¸Šæ˜ ä¸­æ­¢';
    const bEnded = b.startTime === 'ä¸Šæ˜ çµ‚äº†' || b.startTime === 'ä¸Šæ˜ ä¸­æ­¢';

    // ä¸Šæ˜ çµ‚äº†ã¯å¿…ãšå¾Œã‚
    if (aEnded && !bEnded) return 1;
    if (!aEnded && bEnded) return -1;

    // ä¸¡æ–¹æ™‚åˆ»ã‚ã‚Š â†’ æ™‚åˆ»æ¯”è¼ƒ
    if (!aEnded && !bEnded) {
      return a.startTime.localeCompare(b.startTime);
    }

    return 0;
  });

  sortedRows.forEach((row, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${row.startTime}</td>
      <td>ç´„${row.duration}åˆ†</td>
      <td class="tt-title" data-workid="${row.workId || ''}">
      ${row.title}
      </td>
      <td>${row.caution || ''}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById('ttNotes').innerHTML = `
    <p>Aï¼ãŠå­æ§˜ã§ã‚‚ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã™</p>
    <p>Bï¼æµè¡€æå†™ã‚’å«ã¿ã¾ã™ã€€è¦³è¦§ã®éš›ã¯ã”æ³¨æ„ãã ã•ã„</p>
    <p>Cï¼é£²é…’ã‚„å–«ç…™ã®æå†™ã‚’å«ã¿ã¾ã™ã€€è¦³è¦§ã®éš›ã¯ã”æ³¨æ„ãã ã•ã„</p>
    <p>Dï¼ç½å®³æå†™ã‚’å«ã¿ã¾ã™ã€€è¦³è¦§ã®éš›ã¯ã”æ³¨æ„ãã ã•ã„</p>
    <p>Eï¼ä¸€èˆ¬ã®ãŠå®¢æ§˜ã¯ã”è¦§ã„ãŸã ã‘ã¾ã›ã‚“</p>
  `;
}

// =============================
// å‰ã¸ãƒ»æ¬¡ã¸ ãƒœã‚¿ãƒ³
// =============================

document.getElementById('prevDay').onclick = () => {
  if (dayIndex <= 0) return;
  dayIndex--;
  renderDay();
  updateDayButtons();
};

document.getElementById('nextDay').onclick = () => {
  if (dayIndex >= timetableDays.length - 1) return;
  dayIndex++;
  renderDay();
  updateDayButtons();
};

function updateDayButtons() {
  setDayButton('prevDay', dayIndex > 0);
  setDayButton('nextDay', dayIndex < timetableDays.length - 1);
}

function setDayButton(id, enabled) {
  const btn = document.getElementById(id);
  btn.disabled = !enabled;
  btn.classList.toggle('enabled', enabled);
  btn.classList.toggle('disabled', !enabled);
}

// =============================
// åˆæœŸåŒ–
// =============================

window.addEventListener('load', () => {
  const showTimetablePages = ['index', 'top']; // â† è¡¨ç¤ºã—ãŸã„ãƒšãƒ¼ã‚¸

  if (showTimetablePages.includes(PAGE_TYPE)) {
    initTimetable();
  } else {
    const el = document.getElementById('timetableCookie');
    if (el) el.style.display = 'none';
  }
});

document.addEventListener('click', e => {
  const cell = e.target.closest('.tt-title');
  if (!cell) return;

  const workId = cell.dataset.workid;
  if (!workId) return;

  openWorkModal(workId);
});




/*ã‚¿ã‚¤ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ã€€çµ‚*/
/* ãƒ¢ãƒ¼ãƒ€ãƒ«ã¯ã˜ã‚ */

/**
 * è¡¨ç¤ºç”¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
 */
function normalizeWorkData(data) {
  if (!data) return null;
  const imageUrl = data.image || '';

  const imageType =
    /\.pdf$/i.test(imageUrl)
      ? 'pdf'
      : imageUrl
        ? 'image'
        : null;

  return {
    ...data,

    // æ‰€è¦æ™‚é–“ â†’ ç´„â—‹â—‹åˆ†
    durationText:
      data.duration
        ? `æ‰€è¦æ™‚é–“ï¼šç´„${data.duration}åˆ†`
        : '',

    // æ–°ä½œ / éå»ä½œ
    badgeText:
      data.category === 'æ–°ä½œ'
        ? 'æ–°ä½œ'
        : data.category === 'éå»ä½œ'
          ? 'éå»ä½œ'
          : '',

    // ç”»åƒç¨®åˆ¥åˆ¤å®š
    imageType
  };
}


/**
 * ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
 */

function openWorkModal(workId) {
  if (!workId) return;

  document.body.classList.add('modal-open');
  document.getElementById('modal').classList.remove('hidden');

  if (workDetailCache[workId]) {
    showModal(workDetailCache[workId]);
    return;
  }

  openModalSkeleton();

  callGAS('getWorkDetail', { workId })
    .then(res => {
      if (!res) {
        closeModal();
        return;
      }
      workDetailCache[workId] = res;
      showModal(res);
    })
    .catch(err => {
      console.error(err);
      closeModal();
    });
}




/**
 * ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
 */
function closeModal() {
  document.getElementById('modal').classList.add('hidden');
  document.body.classList.remove('modal-open');
}

/**
 * skeleton è¡¨ç¤º
 */
function openModalSkeleton() {
  document.getElementById('modalTitle').textContent = 'èª­ã¿è¾¼ã¿ä¸­â€¦';
  document.getElementById('modalRuby').textContent = '';
  document.getElementById('modalCategory').textContent = '';
  document.getElementById('modalDesc').textContent = '';
  document.getElementById('modalCaution').innerHTML = '';
  document.getElementById('modalNote').textContent = '';
  document.getElementById('modalDuration').textContent = '';
  document.getElementById('modalBadge').textContent = '';

  document.getElementById('modalImage').classList.add('hidden');
  document.getElementById('modalPdf').classList.add('hidden');
  document.getElementById('modalImageSvg').innerHTML = '';
}


/**
 * ãƒ¢ãƒ¼ãƒ€ãƒ«å†…å®¹æç”»
 */
function showModal(rawData) {
  const data = normalizeWorkData(rawData);
  const modalImage = document.getElementById('modalImage');
  const zoomClose = document.getElementById('imageZoomClose');
  const modalBody = document.querySelector('.modal-body');
  console.log('image url =', data.image);
  console.log('imageType =', data.imageType);
  if (!data) return;

  // ===== ãƒ†ã‚­ã‚¹ãƒˆ =====
  modalTitle.textContent = data.title || '';
  modalRuby.textContent = data.ruby ? `ï¼ˆ${data.ruby}ï¼‰` : '';
  modalDesc.textContent = data.description || '';
  modalNote.textContent = data.notes || '';
  modalDuration.textContent = data.durationText || '';

  // ===== ãƒãƒƒã‚¸ =====
  modalBadge.textContent = '';
  modalBadge.className = 'badge';

  if (data.badgeText) {
    modalBadge.textContent = data.badgeText;
    modalBadge.classList.add(
      data.category === 'æ–°ä½œ' ? 'badge-new' : 'badge-archive'
    );
  }

  // ===== æ³¨æ„ =====
  modalCaution.innerHTML = '';
  (data.cautions || []).forEach(t => {
    const p = document.createElement('p');
    p.textContent = t;
    modalCaution.appendChild(p);
  });

  // ===== ç”»åƒ / PDF =====
  modalImage.classList.add('hidden');
  modalPdf.classList.add('hidden');
  modalImageSvg.innerHTML = '';
  modalImage.src = '';
  modalPdf.src = '';

  if (!data.imageType) return;

  if (data.imageType === 'pdf') {
    modalPdf.src = data.image;
    modalPdf.classList.remove('hidden');
  } else {
    modalImage.src = data.image;
    modalImage.classList.remove('hidden');
  }
    // â˜… æ‹¡å¤§çŠ¶æ…‹ã‚’å¿…ãšãƒªã‚»ãƒƒãƒˆ
    modalImage.classList.remove('zoomed');
    zoomClose.classList.add('hidden');
    modalBody.style.overflow = 'auto';
}


/* ===== åˆæœŸãƒ­ãƒ¼ãƒ‰å‡¦ç† ===== */
window.addEventListener('load', () => {

  // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
  document.getElementById('modalClose').onclick = closeModal;
  document.getElementById('modalBack').onclick = closeModal;

  // ç”»åƒã‚¯ãƒªãƒƒã‚¯ã§æ‹¡å¤§
  const modalImage = document.getElementById('modalImage');
  const zoomClose = document.getElementById('imageZoomClose');
  const modalBody = document.querySelector('.modal-body');
  if (modalImage) {
    modalImage.loading = 'lazy';

    modalImage.addEventListener('click', () => {
    modalImage.classList.toggle('zoomed');
    const isZoomed = modalImage.classList.contains('zoomed');
    zoomClose.classList.toggle('hidden', !isZoomed);

    // æ‹¡å¤§ä¸­ã¯èƒŒæ™¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ­¢ã‚ã‚‹ï¼ˆä»»æ„ï¼‰
    modalBody.style.overflow = isZoomed ? 'hidden' : 'auto';
    });
    zoomClose.addEventListener('click', (e) => {
   e.stopPropagation(); // ç”»åƒã‚¯ãƒªãƒƒã‚¯ã¨å¹²æ¸‰ã•ã›ãªã„

    modalImage.classList.remove('zoomed');
    zoomClose.classList.add('hidden');
    modalBody.style.overflow = 'auto';
  });
  }

  // ===== ä½œå“ãƒ‡ãƒ¼ã‚¿äº‹å‰ãƒ­ãƒ¼ãƒ‰ï¼ˆæœ€é‡è¦ï¼‰=====

  callGAS('getAllWorkDetails')
.then(list => {
  if (!Array.isArray(list)) {
    console.error('getAllWorkDetails failed');
    return;
  }

  list.forEach(w => {
    workDetailCache[w.workId] = w;
  });

  worksReady = true;

  // â˜… ä½œå“è©³ç´°ãŒæœ¬å½“ã«æº–å‚™ã§ããŸå¾Œã§ loading ã‚’æ¶ˆã™
  stopLoadingScreen();

  console.log('works preloaded:', Object.keys(workDetailCache).length);
})
.catch(err => {
  console.error('work preload error', err);
  // æœ€ä½é™ UI ã¯è§£é™¤
  stopLoadingScreen();
});

//===== ç”»åƒæ‹¡å¤§å¾Œã®å‹•ã =====

let isDragging = false;
let startX = 0;
let startY = 0;
let currentX = 0;
let currentY = 0;

modalImage.addEventListener('pointerdown', e => {
  if (!modalImage.classList.contains('zoomed')) return;

  isDragging = true;
  startX = e.clientX - currentX;
  startY = e.clientY - currentY;

  modalImage.setPointerCapture(e.pointerId);
});

modalImage.addEventListener('pointermove', e => {
  if (!isDragging) return;

  currentX = e.clientX - startX;
  currentY = e.clientY - startY;

  modalImage.style.transform =
    `scale(2) translate(${currentX}px, ${currentY}px)`;
});

modalImage.addEventListener('pointerup', () => {
  isDragging = false;
});
modalImage.addEventListener('pointercancel', () => {
  isDragging = false;
});

function resetImageTransform(){
  currentX = 0;
  currentY = 0;
  modalImage.style.transform = 'scale(1)';
}

zoomClose.addEventListener('click', () => {
  resetImageTransform();
});

modalImage.addEventListener('click', () => {
  if (!modalImage.classList.contains('zoomed')) return;
  // æ‹¡å¤§è§£é™¤æ™‚
  resetImageTransform();
});




//=====ãƒ¢ãƒ¼ãƒ€ãƒ«çµ‚äº†=====



  // ãƒ˜ãƒƒãƒ€æƒ…å ±
  callGAS('getEventHeader', { siteNo: SITE_NO })
    .then(data => {
      if (!data) return;
      document.getElementById('eventTitle').textContent = data.title || '';
      document.getElementById('eventDesc').textContent = data.description || '';
    });

  // ãƒ­ã‚°
  callGAS('logPageView', {
    pageType: PAGE_TYPE,
    siteNo: SITE_NO
  });

  // æ™‚è¨ˆ
  updateNowDateTime();
  setInterval(updateNowDateTime, 1000);
});

if (PAGE_TYPE !== 'com') {
  callGAS("getButtonData", {
  pageType: PAGE_TYPE,
  siteNo: SITE_NO
}).then(renderButtons);
}

  function updateNowDateTime() {
  const now = new Date();

  const date =
    `${now.getMonth() + 1}æœˆ${now.getDate()}æ—¥`;

  const time =
    now.toTimeString().slice(0, 8); // HH:mm:ss

  document.getElementById('nowDateTime').textContent =
    `ç¾åœ¨ã€€${date}ã€€æ™‚åˆ»ã€€${time}`;
}

 // åˆå›å®Ÿè¡Œ
 updateNowDateTime();

 // 1ç§’æ›´æ–°
 setInterval(updateNowDateTime, 1000);

let eventStart = null;
let eventEnd = null;
  callGAS("getEventHeader", { siteNo: SITE_NO })
  .then(data => {
    document.getElementById('eventTitle').textContent = data.title;
    document.getElementById('eventDesc').textContent = data.description;
  });



//ãƒœã‚¿ãƒ³ã‚’æå†™

if (PAGE_TYPE !== 'com') {
  callGAS("getButtonData", {
  pageType: PAGE_TYPE,
  siteNo: SITE_NO
  }).then(renderButtons);
}

function renderButtons(buttons) {
  console.log('buttons:', buttons); // â†ã“ã“ã§ç¢ºèª
  const area = document.getElementById('linkArea');
  if (!area || !buttons || !buttons.length) return;

  area.style.display = 'flex';
  area.innerHTML = '';

  buttons.forEach(btn => {
    const a = document.createElement('a');
    a.textContent = btn.name;
    a.href = btn.url;
    a.target = btn.target || '_blank';
    a.rel = 'noopener';
    a.className = 'action-button';
    area.appendChild(a);
  });
}



//ãƒœã‚¿ãƒ³ã‚’æå†™çµ‚

console.log('PAGE_TYPE=', PAGE_TYPE);
console.log('SITE_NO=', SITE_NO);


  
</script>

</body>
</html>

